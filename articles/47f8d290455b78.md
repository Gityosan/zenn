---
title: 'Bashã§Storybookãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã‚’è‡ªå‹•åŒ–ã—ã¦ã¿ãŸ'
emoji: 'ğŸ™'
type: 'tech'
topics: ['Nuxtjs', 'Storybook', 'Vite']
published: true
---

# ã¯ã˜ã‚ã«

æ¥­å‹™ã§æ—¢å­˜ç’°å¢ƒã«storybookã‚’å°å…¥ã™ã‚‹æ©Ÿä¼šãŒã‚ã£ãŸã®ã§ã™ãŒã€ãã®éš›ã«ä¸€ã¤ä¸€ã¤æ‰‹ä½œæ¥­ã§æ›¸ãã®ãŒé¢å€’ã§ã—ãŸã®ã§æ¥½ã‚’ã™ã‚‹ã¹ãbash scriptã‚’æ›¸ãã“ã¨ã«ã—ã¾ã—ãŸã€‚

# ã‚„ã‚ŠãŸã„ã“ã¨

ä»Šå›vueã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¤ºã™ã‚‹stories.tsã‚’ä½œæˆã—ã¾ã™ã€‚
ä¸‹è¨˜é››å½¢ã‚’ãƒ™ãƒ¼ã‚¹ã«ãƒ•ã‚¡ã‚¤ãƒ«åã‚„ã‚¢ãƒƒãƒ‘ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã«ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«åã€argsç­‰ã‚’ç½®ãæ›ãˆã¦ã„ãã“ã¨ã‚’è€ƒãˆã¾ã™ã€‚

```typescript:.stories.ts
import ã‚¢ãƒƒãƒ‘ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã«ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«å from 'ç›¸å¯¾ãƒ‘ã‚¹/ãƒ•ã‚¡ã‚¤ãƒ«å.vue'
import type { Meta, StoryObj } from '@storybook/vue3'

type Story = StoryObj<typeof ã‚¢ãƒƒãƒ‘ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã«ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«å >

const meta: Meta<typeof ã‚¢ãƒƒãƒ‘ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã«ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«å > = {
  title: 'ã‚¢ãƒƒãƒ‘ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã«ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«å',
  component: ã‚¢ãƒƒãƒ‘ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã«ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«å,
  render: (args) => ({
    components: { ã‚¢ãƒƒãƒ‘ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã«ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«å },
    setup: () => ({ args }),
    template: "<ã‚¢ãƒƒãƒ‘ãƒ¼ã‚­ãƒ£ãƒ¡ãƒ«ã«ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«å v-bind='args' />"
  }),
  tags: ['autodocs']
}

export const Default: Story = {
  args: æŠœãå‡ºã—ãŸdefaultå€¤é”
}

export default meta
```

# å…ˆã«å…¨ä½“åƒ

ä¸­ã§`source pathlib.bash`ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™ãŒã€äºŒã¤ã®ãƒ‘ã‚¹ã‹ã‚‰ç‰‡æ–¹ã®ãƒ‘ã‚¹ã‹ã‚‰ç‰‡æ–¹ã®ãƒ‘ã‚¹ã¾ã§ã®ç›¸å¯¾ãƒ‘ã‚¹ã‚’å–å¾—ã™ã‚‹é–¢æ•°ã‚’å®šç¾©ã—ã¦ã„ã¾ã™ã€‚

```bash:create.bash
#!/bin/bash

# å¼•æ•°ã®æ•°ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€å¼•æ•°ãŒ3ã¤ä»¥ä¸Šã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºåŠ›ã—ã¦çµ‚äº†
if [ "$#" -ge 3 ]; then
  echo "Usage: $0 <input_folder_path> <output_folder_path>"
  exit 1
fi

# ãƒ•ã‚©ãƒ«ãƒ€ã®ç›¸å¯¾ãƒ‘ã‚¹ã‚’å–å¾—
input_folder_path=${1:-src/components}
output_folder_path=${2:-$input_folder_path}

# çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
input_folder_absolute_path=$(realpath "$input_folder_path")
output_folder_absolute_path=$(realpath "$output_folder_path")

# output_folder_absolute_pathã‹ã‚‰input_folder_absolute_pathã¸ã®ç›¸å¯¾ãƒ‘ã‚¹ã‚’è¨ˆç®—
script_dir=$(cd "$(dirname "$0")"; pwd)
PATH="$PATH:$script_dir"
source pathlib.bash
from_output_to_input_relative_path=$(path_get_relative "$output_folder_absolute_path" "$input_folder_absolute_path")

# Vueãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†å¸°çš„ã«æ¤œç´¢ã—ã¦å‡¦ç†
find "$input_folder_path" -type f -name "*.vue" | while read -r vue_file_path; do

  # ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æ‹¡å¼µå­ã‚’å‰Šé™¤ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—
  file_name=$(basename -- "$vue_file_path")
  file_name_no_ext="${file_name%.vue}"

  # UpperCamelCaseã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç”Ÿæˆ
  upper_camel_case_file_name=$(echo "$file_name_no_ext" | awk -F'[-_]' '{ for(i=1; i<=NF; i++) $i=toupper(substr($i,1,1)) tolower(substr($i,2)); }1' OFS='')

  # å¯¾å¿œã™ã‚‹stories.tsãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’ç”Ÿæˆ
  vue_file="${vue_file_path#$input_folder_path}"
  stories_file_path="${output_folder_path}${vue_file%.*}.stories.ts"

  # æ—¢ã«åŒåã®stories.tsãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
  if [ -e "$stories_file_path" ]; then
    echo "Skip: $stories_file_path already exists."
    continue
  fi

  # â‘ ã¨â‘¡ OptionsAPIã®å ´åˆ
  props_output=$(awk '
  BEGIN { flag=0; key=""; value=""; nestLevel=0; print "{"; }

  /props: {/ { flag=1; nestLevel=1; }

  flag {
    if ($1 ~ /^[a-zA-Z0-9]+:$/ && nestLevel == 2) {
      key = substr($1, 1, length($1)-1);
    }
    if ($1 ~ /^default:/) {
      value = $0;
      sub(/[[:space:]]*default:/, "", value);
      sub(/,.*$/, "", value);
      if (value != "") { printf "%*s%s: %s,\n", (nestLevel - 1) * 2, "", key, value; }
    }
    for(i=1; i<=length($0); i++) {
      char = substr($0, i, 1);
      if (char == "{") { nestLevel++; }
      if (char == "}") { nestLevel--; }
    }
    if (nestLevel == 0) exit;
  }
  END { print "  },"; }
  ' $vue_file_path)

  if [[ -n $props_output ]]; then
    args=$props_output
  fi

  # â‘¢ã¨â‘£ withDefaultã‚’ä½¿ã‚ãªã„CompositionAPIã®å ´åˆ
  define_props_output=$(awk '
  BEGIN { flag=0; key=""; value=""; nestLevel=0; print "{"; }

  /defineProps.*\({/ { flag=1; }

  flag {
    if ($1 ~ /^[a-zA-Z0-9]+:$/ && nestLevel == 1) {
      key = substr($1, 1, length($1)-1);
    }
    if ($1 ~ /^default:/) {
      value = $0;
      sub(/[[:space:]]*default:/, "", value);
      sub(/,.*$/, "", value);
      if (value != "") { printf "%*s%s:%s,\n", (nestLevel - 1) * 2, "", key, value; }
    }
    for(i=1; i<=length($0); i++) {
      char = substr($0, i, 1);
      if (char == "{") { nestLevel++; }
      if (char == "}") { nestLevel--; }
    }
    if (nestLevel == 0) exit;
  }
  END { print "  },"; }
  ' "$vue_file_path")

  if [[ -n $define_props_output ]]; then
    args=$define_props_output
  fi

  # â‘¤ withDefaultã‚’ä½¿ã†CompositionAPIã®å ´åˆ
  with_defaults_output=$(awk '
  BEGIN { flag=0; }
  /withDefaults\(/ { flag=1; next; }
  flag == 1 && /^[^,]+),/ { flag=2; next; }
  flag == 2 {
    print $0;
    if ($0 ~ /^[^}]+}/) {
      exit;
    }
  }
  ' $vue_file_path)
  if [[ -n $with_defaults_output ]]; then
    args=$with_defaults_output
  fi

  # stories.tsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
  cat > "$stories_file_path" <<EOL
import $upper_camel_case_file_name from '${from_output_to_input_relative_path:-.}/$file_name_no_ext.vue';
import type { Meta, StoryObj } from '@storybook/vue3';

type Story = StoryObj<typeof $upper_camel_case_file_name>;

const meta: Meta<typeof $upper_camel_case_file_name> = {
  title: '$upper_camel_case_file_name',
  component: $upper_camel_case_file_name,
  render: (args) => ({
    components: { $upper_camel_case_file_name },
    setup: () => ({ args }),
    template: "<$upper_camel_case_file_name v-bind='args' />",
  }),
  tags: ['autodocs'],
};

export const Default: Story = {
  args: $args
};

export default meta;
EOL

  echo "Created: $stories_file_path"
done
```

# è¦æ‰€è§£èª¬

## 1. ãƒ‘ã‚¹ã®å–ã‚Šæ‰±ã„

å¼•æ•°ã‚’`input_folder_path`ã¨`output_folder_path`ã«æ§ãˆã¾ã™ã€‚
`input_folder_path`ã¯`$1`ã‚’å—ã‘å–ã‚Šã€`$1`ãŒãªã„æ™‚ã¯åˆæœŸå€¤ã¨ã—ã¦`src/componests`ã‚’ä»£å…¥ã—ã¾ã™ã€‚
`output_folder_path`ã¯`$2`ã‚’å—ã‘å–ã‚Šã€`$2`ãŒãªã„æ™‚ã¯åˆæœŸå€¤ã¨ã—ã¦`$1`ã‚’ä»£å…¥ã—ã¾ã™ã€‚
`output_folder_absolute_path`ã‹ã‚‰`input_folder_absolute_path`ã¸ã®ç›¸å¯¾ãƒ‘ã‚¹ã‚’è¨ˆç®—ã—ã¦ã€`from_output_to_input_relative_path`ã«æ ¼ç´ã—ã¾ã™ã€‚

```bash:create.bash
# ãƒ•ã‚©ãƒ«ãƒ€ã®ç›¸å¯¾ãƒ‘ã‚¹ã‚’å–å¾—
input_folder_path=${1:-src/components}
output_folder_path=${2:-$input_folder_path}

# çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›
input_folder_absolute_path=$(realpath "$input_folder_path")
output_folder_absolute_path=$(realpath "$output_folder_path")

# output_folder_absolute_pathã‹ã‚‰input_folder_absolute_pathã¸ã®ç›¸å¯¾ãƒ‘ã‚¹ã‚’è¨ˆç®—
script_dir=$(cd "$(dirname "$0")"; pwd)
PATH="$PATH:$script_dir"
source pathlib.bash
from_output_to_input_relative_path=$(path_get_relative "$output_folder_absolute_path" "$input_folder_absolute_path")
```

<br>

## 2. vueãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã‚’èª­ã¿è¾¼ã‚“ã§å„ç¨®å‡¦ç†ã‚’è¡Œãªã†

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®å¤§ã¾ã‹ãªæµã‚Œã¯ä¸‹è¨˜ã®é€šã‚Šã§ã™ã€‚

1. èª­ã¿è¾¼ã‚“ã§ã„ã‚‹vueãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åã¨UpperCamelCaseã«å¤‰æ›ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—ã™ã‚‹
2. 1ã§å–å¾—ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«åã¨å…ˆç¨‹å–å¾—ã—ãŸoutput_folder_pathã‹ã‚‰å‡ºåŠ›å…ˆã®ãƒ‘ã‚¹ã‚’ä½œæˆã™ã‚‹
3. æ—¢ã«å‡ºåŠ›äºˆå®šã®stories.tsãƒ•ã‚¡ã‚¤ãƒ«ã¨åŒåã®stories.tsãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦æ¬¡ã®vueãƒ•ã‚¡ã‚¤ãƒ«ã«ç§»ã‚‹
4. vueãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰propsã®defaulté”ã‚’æŠœãå‡ºã™ï¼ˆã“ã“ã¯æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã§è©³èª¬ã—ã¾ã™ï¼‰
5. ã“ã“ã¾ã§æ•´ç†ã—ãŸæƒ…å ±é”ã‚’ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«æµã—è¾¼ã‚“ã§ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦å‡ºåŠ›ã™ã‚‹

```bash:create.bash
# Vueãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†å¸°çš„ã«æ¤œç´¢ã—ã¦å‡¦ç†
find "$input_folder_path" -type f -name "*.vue" | while read -r vue_file_path; do

  # ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æ‹¡å¼µå­ã‚’å‰Šé™¤ã—ã€ãƒ•ã‚¡ã‚¤ãƒ«åã‚’å–å¾—
  file_name=$(basename -- "$vue_file_path")
  file_name_no_ext="${file_name%.vue}"

  # UpperCamelCaseã®ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ç”Ÿæˆ
  upper_camel_case_file_name=$(echo "$file_name_no_ext" | awk -F'[-_]' '{ for(i=1; i<=NF; i++) $i=toupper(substr($i,1,1)) tolower(substr($i,2)); }1' OFS='')

  # å¯¾å¿œã™ã‚‹stories.tsãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’ç”Ÿæˆ
  vue_file="${vue_file_path#$input_folder_path}"
  stories_file_path="${output_folder_path}${vue_file%.*}.stories.ts"

  # æ—¢ã«åŒåã®stories.tsãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
  if [ -e "$stories_file_path" ]; then
    echo "Skip: $stories_file_path already exists."
    continue
  fi

  # â‘ ã¨â‘¡ OptionsAPIã®å ´åˆ
  props_output=$(awk '
  <ä¸­ç•¥>
  ' $vue_file_path)

  if [[ -n $props_output ]]; then
    args=$props_output
  fi

  # â‘¢ã¨â‘£ withDefaultã‚’ä½¿ã‚ãªã„CompositionAPIã®å ´åˆ
  define_props_output=$(awk '
  <ä¸­ç•¥>
  ' "$vue_file_path")

  if [[ -n $define_props_output ]]; then
    args=$define_props_output
  fi

  # â‘¤ withDefaultã‚’ä½¿ã†CompositionAPIã®å ´åˆ
  with_defaults_output=$(awk '
  <ä¸­ç•¥>
  ' $vue_file_path)
  if [[ -n $with_defaults_output ]]; then
    args=$with_defaults_output
  fi

  # stories.tsãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
  cat > "$stories_file_path" <<EOL
<ä¸­ç•¥>
EOL

  echo "Created: $stories_file_path"
done
```

<br>

## 3. vueãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰propsã®defaulté”ã‚’æŠœãå‡ºã™

vueãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰propsã®defaulté”ã‚’æŠœãå‡ºã™ç®‡æ‰€ã«é–¢ã—ã¦ã¯å¤§ããä¸‰ã¤ã®éƒ¨åˆ†ã‹ã‚‰æˆã‚Šã¾ã™ã€‚ãã‚Œãã‚Œã§æŒ‡å®šã™ã‚‹æ¡ä»¶ã«ãƒãƒƒãƒã—ãŸå ´åˆã¯defaultå€¤é”ã‚’æŠœãå‡ºã—ã¦å¤‰æ•°argsã«æ ¼ç´ã—ã¦ã„ã¾ã™ã€‚

ã“ã“ã§è€ƒãˆãªã‘ã‚Œã°ã„ã‘ãªã„ã®ã¯vueã«ãŠã‘ã‚‹propsã®æŒ‡å®šæ–¹æ³•ã§ã™ã€‚OptionsAPIã¨CompositionAPIã€typescriptã‚’ä½¿ã†ãƒ»ä½¿ã‚ãªã„ã€CompositionAPIã®ã¿withDefaultsã‚’ä½¿ã†ä½¿ã‚ãªã„ã®çµ„ã¿åˆã‚ã›ã§è¨ˆï¼•ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚ã‚Šã¾ã™ã€‚

ãã‚Œãã‚Œä¾‹ã‚’è¦‹ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

**â‘ TSã‚’ä½¿ã‚ãªã„OptionsAPI**

```vue:options-js.vue
<script>
import { defineComponent } from 'vue'
export default defineComponent({
  props: {
    text: {
      type: String,
      required: true
    },
    user:{
      type: Object,
      default: () => ({})
    },
    active: {
      type: Boolean,
      default: false
    }
  }
})
</script>
```

**â‘¡TSã‚’ä½¿ã£ãŸOptionsAPI**

```vue:options-ts.vue
<script lang="ts">
import { defineComponent } from 'vue'
import type { PropType } from 'vue'
interface User {
  name: string;
  age: number;
}
export default defineComponent({
  props: {
    text: {
      type: String,
      required: true
    },
    user:{
      type: Object as PropType<User>,
      default: () => ({})
    },
    active: {
      type: Boolean,
      default: false
    }
  }
})
</script>
```

**â‘¢TSã‚’ä½¿ã‚ãªã„CompositionAPI**

```vue:composition-js.vue
<script setup>
import { defineProps } from 'vue';
const props = defineProps(['text', 'user', 'active']);
// â†‘ã®æ›¸ãæ–¹ã‚‚ã§ãã‚‹ãŒdefaultå€¤ã‚’è¨­å®šã™ã‚‹å ´åˆã¯çµå±€â†“ã®å½¢
const props = defineProps({
  text: {
    type: String,
    required: true
  },
  user:{
    type: Object,
    default: () => ({})
  },
  active: {
    type: Boolean,
    default: false
  },
});
</script>
```

**â‘£TSã‚’ä½¿ã†CompositionAPI**

```vue:composition-ts.vue
<script setup lang="ts">
import type { ComponentObjectPropsOptions } from 'vue'
interface User {
  name?: string
  age?: number
}
interface Props {
  text: string
  user: User
  active: boolean
}
const props = defineProps<ComponentObjectPropsOptions<Props>>({
  text: {
    required: true
  },
  user: {
    default: () => ({})
  },
  active: {
    default: false
  }
})
</script>
```

**â‘¤TSã‚’ä½¿ã„withDefaultsã‚‚ä½¿ã†CompositionAPI**

```vue:withDefaults-composition-ts.vue
<script setup lang="ts">
import { defineProps } from 'vue';
interface User {
  name: string;
  age: number;
}
interface Props {
  text: string;
  user: User;
  active: boolean;
}
const props = withDefaults(defineProps<Props>(), {
  text: '',
  user: () => ({}),
  active: false
})
</script>
```

ã“ã†ã‚„ã£ã¦è¦‹æ¯”ã¹ã¦ã¿ã‚‹ã¨ã€propsã‚’æŠœãå‡ºã™ã«ã‚ãŸã£ã¦â‘ ã¨â‘¡ã€â‘¢ã¨â‘£ã€â‘¤ã®ï¼“ã¤ã«å ´åˆåˆ†ã‘ã§ãã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚

1. â‘ ã¨â‘¡ OptionsAPIã®å ´åˆ
2. â‘¢ã¨â‘£ withDefaultã‚’ä½¿ã‚ãªã„CompositionAPIã®å ´åˆ
3. â‘¤ withDefaultã‚’ä½¿ã†CompositionAPIã®å ´åˆ

ç¶šã„ã¦å„å ´åˆã®å‡¦ç†ã‚’èª¬æ˜ã—ã¾ã™

```bash:create.bash
<ä¸­ç•¥>
# Vueãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†å¸°çš„ã«æ¤œç´¢ã—ã¦å‡¦ç†
find "$input_folder_path" -type f -name "*.vue" | while read -r vue_file_path; do
  <ä¸­ç•¥>
  # â‘ ã¨â‘¡ OptionsAPIã®å ´åˆ
  props_output=$(awk '
  BEGIN { flag=0; key=""; value=""; nestLevel=0; print "{"; }

  /props: {/ { flag=1; nestLevel=1; }

  flag {
    if ($1 ~ /^[a-zA-Z0-9]+:$/ && nestLevel == 2) {
      key = substr($1, 1, length($1)-1);
    }
    if ($1 ~ /^default:/) {
      value = $0;
      sub(/[[:space:]]*default:/, "", value);
      sub(/,.*$/, "", value);
      if (value != "") { printf "%*s%s: %s,\n", (nestLevel - 1) * 2, "", key, value; }
    }
    for(i=1; i<=length($0); i++) {
      char = substr($0, i, 1);
      if (char == "{") { nestLevel++; }
      if (char == "}") { nestLevel--; }
    }
    if (nestLevel == 0) exit;
  }
  END { print "  },"; }
  ' $vue_file_path)

  if [[ -n $props_output ]]; then
    args=$props_output
  fi

  # â‘¢ã¨â‘£ withDefaultã‚’ä½¿ã‚ãªã„CompositionAPIã®å ´åˆ
  define_props_output=$(awk '
  BEGIN { flag=0; key=""; value=""; nestLevel=0; print "{"; }

  /defineProps.*\({/ { flag=1; }

  flag {
    if ($1 ~ /^[a-zA-Z0-9]+:$/ && nestLevel == 1) {
      key = substr($1, 1, length($1)-1);
    }
    if ($1 ~ /^default:/) {
      value = $0;
      sub(/[[:space:]]*default:/, "", value);
      sub(/,.*$/, "", value);
      if (value != "") { printf "%*s%s:%s,\n", (nestLevel - 1) * 2, "", key, value; }
    }
    for(i=1; i<=length($0); i++) {
      char = substr($0, i, 1);
      if (char == "{") { nestLevel++; }
      if (char == "}") { nestLevel--; }
    }
    if (nestLevel == 0) exit;
  }
  END { print "  },"; }
  ' "$vue_file_path")

  if [[ -n $define_props_output ]]; then
    args=$define_props_output
  fi

  # â‘¤ withDefaultã‚’ä½¿ã†CompositionAPIã®å ´åˆ
  with_defaults_output=$(awk '
  BEGIN { flag=0; }
  /withDefaults\(/ { flag=1; next; }
  flag == 1 && /^[^,]+),/ { flag=2; next; }
  flag == 2 {
    print $0;
    if ($0 ~ /^[^}]+}/) {
      exit;
    }
  }
  ' $vue_file_path)
  if [[ -n $with_defaults_output ]]; then
    args=$with_defaults_output
  fi
  <ä¸­ç•¥>
done
```

### â‘ ã¨â‘¡ OptionsAPIã®å ´åˆ

ã¾ãšåˆæœŸåŒ–ã—ã¾ã™

```awk
BEGIN { flag=0; key=""; value=""; nestLevel=0; print "{"; }
```

`props: {`(ãƒˆãƒªã‚¬ãƒ¼ã¨ãªã‚‹æ–‡å­—åˆ—)ã‚’æ¤œçŸ¥ã™ã‚‹ã¨flagã‚’ã‚ªãƒ³ã«ã™ã‚‹
nestLevelã‚‚1ã«ã—ã¦ãŠã

```awk
/props: {/ { flag=1; nestLevel=1; }
```

flagãŒ1ä»¥ä¸Šã ã£ãŸå ´åˆã«è¡Œã†å‡¦ç†ãŒï¼”ã¤ã‚ã‚Šã¾ã™
keyã‚’æŠœãå‡ºã™å‡¦ç†ãƒ»valueã‚’æŠœãå‡ºã—ã¦keyã¨åˆã‚ã›ã¦å‡ºåŠ›ã™ã‚‹å‡¦ç†ãƒ»`{`ã‚„`}`ãŒã‚ã£ãŸå ´åˆã«nestLevelã‚’å¢—æ¸›ã™ã‚‹å‡¦ç†ãƒ»nestLevelãŒ0ã®å ´åˆï¼propsã®ã‚¨ãƒªã‚¢ãŒçµ‚ã‚ã£ãŸå ´åˆã«å‡¦ç†ã‚’æŠœã‘ã‚‹å‡¦ç†

```awk
flag {
  # nestLevelãŒ2ã®æ™‚ã«keyã‚’æŠœãå‡ºã™å‡¦ç†
  if ($1 ~ /^[a-zA-Z0-9]+:$/ && nestLevel == 2) {
    key = substr($1, 1, length($1)-1);
  }
  # valueã‚’æŠœãå‡ºã—ã¦keyã¨åˆã‚ã›ã¦å‡ºåŠ›ã™ã‚‹å‡¦ç†
  if ($1 ~ /^default:/) {
    value = $0; # $0=è¡Œå…¨ä½“ã‚’valueã«ä»£å…¥
    sub(/[[:space:]]*default:/, "", value); # valueã‚ˆã‚Šæ‰‹å‰ã‚’å‰Šé™¤
    sub(/,.*$/, "", value); # valueã‚ˆã‚Šå¾Œ=ã‚«ãƒ³ãƒä»¥é™ã‚’å‰Šé™¤
    if (value != "") { printf "%*s%s: %s,\n", (nestLevel - 1) * 2, "", key, value; } # ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆç­‰ã‚’èª¿æ•´ã—ã¤ã¤å‡ºåŠ›
  }
  # {ã‚„}ãŒã‚ã£ãŸå ´åˆã«nestLevelã‚’å¢—æ¸›ã™ã‚‹å‡¦ç†
  for(i=1; i<=length($0); i++) {
    char = substr($0, i, 1); # 1æ–‡å­—ãšã¤ç¢ºèª
    if (char == "{") { nestLevel++; }
    if (char == "}") { nestLevel--; }
  }
  # nestLevelãŒ0ã®å ´åˆï¼propsã®ã‚¨ãƒªã‚¢ãŒçµ‚ã‚ã£ãŸå ´åˆã«å‡¦ç†ã‚’æŠœã‘ã‚‹å‡¦ç†
  if (nestLevel == 0) exit;
}
```

æœ«å°¾ã®` },`ã‚’å‡ºåŠ›ã—ã¦çµ‚äº†

```awk
END { print "  },"; }
```

### â‘¢ã¨â‘£ withDefaultã‚’ä½¿ã‚ãªã„CompositionAPIã®å ´åˆ

æ¦‚ã­ â‘ ã¨â‘¡ OptionsAPIã®å ´åˆã¨åŒã˜
`props: {`ã®ä»£ã‚ã‚Šã«`defineProps.\*\({`ã‚’æ¤œçŸ¥ã™ã‚‹
propsã®ãƒã‚¹ãƒˆãŒç„¡ã„åˆ†ã€keyã‚’æŠœãå‡ºã™ã®ã¯`nestLevel == 2`ã§ã¯ãªã`nestLevel == 1`ã«å¤‰ã‚ã‚‹

### â‘¤ withDefaultã‚’ä½¿ã†CompositionAPIã®å ´åˆ

åˆæœŸåŒ–ã—ã¦ã€`withDefaults(`ã‚’æ¤œçŸ¥ã—ãŸã‚‰flagã‚’ã‚ªãƒ³ã«ã™ã‚‹

```awk
BEGIN { flag=0; }
/withDefaults\(/ { flag=1; next; }
```

å…ˆé ­ã‹ã‚‰`^`ã‚«ãƒ³ãƒãŒç„¡ã„`[^,]`è¡Œã ã£ãŸå ´åˆflagã‚’2ã«ã™ã‚‹
flagãŒ2ã®å ´åˆã€withDefaultã®ç¬¬äºŒå¼•æ•°ã€defaultå€¤ã®å®šç¾©ç®‡æ‰€ãªã®ã§ãã®ã¾ã¾å‡ºåŠ›ã™ã‚‹
ãŸã ã—ã€å…ˆé ­ã‹ã‚‰`^`ã€`}`ãŒç„¡ã„`[^}]`æ–‡å­—ãŒç¶šã„ãŸå¾Œã«ä¸€ã¤ã ã‘`}`ãŒã‚ã£ãŸå ´åˆã€ãã“ã¯defaultå€¤ã®å®šç¾©ç®‡æ‰€ã®çµ‚äº†åœ°ç‚¹ãªã®ã§å‡¦ç†ã‚’çµ‚äº†ã™ã‚‹

```awk
flag == 1 && /^[^,]+),/ { flag=2; next; }
flag == 2 {
  print $0;
  if ($0 ~ /^[^}]+}/) {
    exit;
  }
}
```

# ãŠã‚ã‚Šã«

ä»Šå›chatGPTå…ˆç”Ÿã«å¤§å¤‰åŠ©ã‘ã‚‰ã‚Œã¾ã—ãŸã€‚æ–°ãŸã«ä½•ã‹ã‚’å­¦ã¶éš›ã«ã¯å¿…é ˆã§ã™ã­ã€‚

# å‚è€ƒè¨˜äº‹

https://ja.vuejs.org/guide/typescript/composition-api.html
https://ja.vuejs.org/guide/typescript/options-api.html
