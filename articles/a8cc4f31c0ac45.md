---
title: 'ç¶šãƒ»Nuxt3ã®é–‹ç™ºç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œã£ã¦ã¿ãŸ(Docker/Vitest/Storybookå¯¾å¿œ)'
emoji: 'ğŸ”–'
type: 'tech'
topics: ['nuxtjs', 'docker', 'vitest', 'storybook']
published: false
---

## ã¯ã˜ã‚ã«

2022/08ã«rcç‰ˆã«ãªã£ãŸNuxt3ã®é–‹ç™ºç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚ãã‚Œã‹ã‚‰ï¼‘å¹´ãŒçµŒã¡ã€å‘¨è¾ºãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæ•´ã£ã¦ããŸãŸã‚æ”¹ã‚ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ‹¡å¼µã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

## æˆæœç‰©

https://github.com/Gityosan/Nuxt3-template

æ˜¯éã€ŒUse this templateã€ã‹ã‚‰ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã£ã¦ä½¿ã£ã¦ã¿ã¦ãã ã•ã„ã€‚

## è¦æ‰€è§£èª¬

### **Versionç­‰(ä»Šå›è¿½åŠ ã—ãŸç®‡æ‰€ã‚’ä¸­å¿ƒã«è¦æ‰€ã®ã¿æŠœç²‹)**

(nodeã«é–¢ã—ã¦ã¯20ç³»ã®æœ€æ–°ç‰ˆã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™)

```json:package.json
{
  <ä¸­ç•¥>
  "devDependencies": {
    "@nuxt/devtools": "^1.0.0-beta.0",
    "@nuxtjs/critters": "^0.5.1",
    "@storybook/vue3": "^7.4.6",
    "@vitest/coverage-v8": "^0.34.6",
    "@vitest/ui": "^0.34.6",
    "@vue/test-utils": "^2.4.1",
    "jsdom": "^22.1.0",
    "nuxt": "^3.7.4",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "storybook": "^7.4.6",
    "typescript": "^5.2.2",
    "unplugin-auto-import": "^0.16.6",
    "unplugin-vue-components": "^0.25.2",
    "vitest": "^0.34.6",
    "vuetify": "^3.3.20"
  }
  <ä¸­ç•¥>
}
```

### Dockerå¯¾å¿œ

å€‹äººçš„ã«ã¯dockerã§ç«‹ã¡ä¸Šã’ã‚‹ã®ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã ã‘ã§ã„ã„ã ã‚ã†ã¨è€ƒãˆã¦ã„ã¾ã—ãŸãŒã„ã–ã€dockerã‚’æ§‹ç¯‰ã—ã¦ã¿ã‚‹ã¨æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯ä½¿ã‚ãªã„ã¨ã—ã¦ã‚‚ã‚„ã£ã±ã‚Šç«‹ã¡ä¸Šã’ãŒæ¥½ã§ã™ã­ã€‚

ã¾ãšã¯Dockerfileã‹ã‚‰

```Dockerfile:Dockerfile
FROM node:20-alpine3.17

ENV TZ Asia/Tokyo

WORKDIR /frontend
```

**å¾Œè¿°ã™ã‚‹ç†ç”±ã®ãŸã‚ã«Dockerfileã§ã¯`RUN npm install`ãªã©ã‚’è¡Œã„ã¾ã›ã‚“ã€‚**

ç¶šã„ã¦compose.yml

```yml:compose.yml
version: '3.9'

services:
  dev_nuxt:
    container_name: dev_nuxt
    build:
      context: .
    volumes:
      - .:/frontend:cached
      - nuxt-node-modules:/frontend/node_modules:delegated
    ports:
      - '3000:3000'
    tty: true
    environment:
      - CHOKIDAR_USEPOLLING=true
    command: >
      sh -c `
      npm install &&
      npm run dev
      `
  prod_nuxt:
    container_name: prod_nuxt
    build:
      context: .
    volumes:
      - .:/frontend:cached
      - nuxt-node-modules:/frontend/node_modules:delegated
    ports:
      - '3001:3001'
    tty: true
    environment:
      - CHOKIDAR_USEPOLLING=true
      - PORT=3001
    command: >
      sh -c `
      npm install &&
      npm run build &&
      node ./.output/server/index.mjs
      `
  storybook:
    container_name: storybook
    build:
      context: .
    volumes:
      - .:/frontend:cached
      - nuxt-node-modules:/frontend/node_modules:delegated
    ports:
      - '6006:6006'
    tty: true
    environment:
      - CHOKIDAR_USEPOLLING=true
    command: >
      sh -c `
      npm install &&
      npm run storybook
      `

volumes:
  nuxt-node-modules:
```

dev_nuxtã¨prod_nuxtã€ãã‚Œã‹ã‚‰storybookã®ç’°å¢ƒã‚’ç«‹ã¡ä¸Šã’ã¦ã„ã¾ã™ã€‚`vitest -ui`ã§ç«‹ã¡ä¸ŠãŒã‚‹ãƒ†ã‚¹ãƒˆçµæœç”»é¢ã‚‚ã‚³ãƒ³ãƒ†ãƒŠã«ã—ã‚ˆã†ã‹è€ƒãˆãŸã‚“ã§ã™ãŒã€æ‰‹å‹•ã§ç«‹ã¡ä¸Šã’ã¦ã‚‚æ‰‹é–“ã§ã¯ãªã„ã®ã§ã‚„ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚

ã¾ãšã€å…ˆè¿°ã®Dockerfileã§ã¯`RUN npm install`ã‚’è¡Œã‚ãšã€compose.ymlã§ã‚„ã£ã¦ã„ã‚‹ç†ç”±ã§ã™ãŒã€Dockerfileã§ã¯`RUN npm install`ã‚’è¡Œã†å ´åˆã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ›´æ–°ãŒã‚ã£ãŸéš›ã«ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆã‚ãã¾ã§ä¸€ä¾‹ã«ãªã‚Šã¾ã™ã€‚å®Ÿéš›ã«ã¯ã‚„ã‚Šæ–¹ã¯ä½•é€šã‚Šã‹ã‚ã‚Šã¾ã™ï¼‰

```bash
docker compose run --rm dev_nuxt npm install
docker compose run --rm prod_nuxt npm install
docker compose run --rm storybook npm install
```

å€‹äººé–‹ç™ºãªã‚‰å•é¡Œãªã„ã®ã§ã™ãŒã€ï¼ˆä¼šç¤¾ç­‰ã§ï¼‰è¤‡æ•°äººã§é–‹ç™ºã—ã¦ã„ã‚‹å ´åˆã€PRã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹éš›ã«ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã®æ‰“ã¡å¿˜ã‚ŒãŒç™ºç”Ÿã—å¾—ã‚‹ã®ã§ã™ã€‚ãã®åº¦ã«
**ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼**ã€Œã“ã®PRå‹•ã‹ãªã„ã‚ˆã€
**ç­†è€…**ã€Œã‚ã€ä»Šå›ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ›´æ–°ãŒã‚ã£ãŸã®ã§æ›´æ–°ã‚³ãƒãƒ³ãƒ‰æ‰“ã£ã¦ãã ã•ã„ï¼ã€
**ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼**ã€Œäº†è§£ã€œã€
ã¿ãŸã„ãªå•ç­”ã‚’ã™ã‚‹ã®ã‚‚æ‰‹é–“ã§ã™ã€‚

ãã®ãŸã‚ã€`npm install`ã¯compose.ymlã®commandã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚
ä¸‹è¨˜è¨˜äº‹ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚

https://qiita.com/shindex/items/1deb070222d55a7d645d

### Vitestå¯¾å¿œ

viteãƒ™ãƒ¼ã‚¹ã®vueç’°å¢ƒã ã¨vite.config.tsã®ä¸­ã«æ›¸ã„ãŸã‚Šã‚‚ã—ã¾ã™ãŒã€nuxtã§ã¯nuxt.config.tsãŒã‚ã‚‹ã®ã§testã«é–¢ã™ã‚‹è¨­å®šã®ã¿ã‚’æ›¸ãvitest.config.tsã‚’ä½œæˆã—ã¾ã™ã€‚

happy-domã‚’ä½¿ã†ã®ã‚‚è‰¯ã‹ã£ãŸã‚“ã§ã™ãŒã€å®‰å®šæ€§é‡è¦–ã§jsdomæ¡ç”¨ã¨ã—ã¾ã—ãŸã€‚
ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¯å¿…è¦ã«å¿œã˜ã¦è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

ã‚ã¨ã¯testé…ä¸‹ã«.test.tsã‹.spec.tsã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã ã‘ã§ã™ã€‚

```ts:vitest.config.ts
// <reference types="vitest">
import { defineConfig } from 'vitest/config'
import Vue from '@vitejs/plugin-vue'
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import { Vuetify3Resolver } from 'unplugin-vue-components/resolvers'
import { fileURLToPath } from 'node:url'

export default defineConfig({
  plugins: [
    Vue(),
    AutoImport({
      dirs: ['utils', 'composables'],
      imports: ['vue', 'vue-router', 'vitest'],
      dts: 'test/auto-imports.d.ts'
    }),
    Components({
      dirs: ['components'],
      resolvers: [Vuetify3Resolver()],
      dts: 'test/components.d.ts'
    })
  ],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./', import.meta.url))
    }
  },
  test: {
    root: '.',
    globals: true,
    environment: 'jsdom',
    coverage: {
      provider: 'v8',
      enabled: true
    }
  }
})
```

### Storybookå¯¾å¿œ

ä»Šå›ã®æ›´æ–°ä½œæ¥­ã®ä¸­ã§ä¸€ç•ªæ™‚é–“ãŒæ›ã‹ã‚Šã¾ã—ãŸã€‚ã€‚ã€‚
