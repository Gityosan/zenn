---
title: 'ç¶šãƒ»Nuxt3ã®é–‹ç™ºç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œã£ã¦ã¿ãŸ(Docker/Vitest/Storybookå¯¾å¿œ)'
emoji: 'ğŸ”–'
type: 'tech'
topics: ['nuxtjs', 'docker', 'vitest', 'storybook']
published: true
---

## ã¯ã˜ã‚ã«

2022/08ã«rcç‰ˆã«ãªã£ãŸNuxt3ã®é–‹ç™ºç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã—ã¾ã—ãŸã€‚ãã‚Œã‹ã‚‰ï¼‘å¹´ãŒçµŒã¡ã€å‘¨è¾ºãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæ•´ã£ã¦ããŸãŸã‚æ”¹ã‚ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’æ‹¡å¼µã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚

## æˆæœç‰©

https://github.com/Gityosan/Nuxt3-template

https://github.com/Gityosan/Nuxt3-template-with-storybook

æ˜¯éã€ŒUse this templateã€ã‹ã‚‰ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã£ã¦ä½¿ã£ã¦ã¿ã¦ãã ã•ã„ã€‚

## è¦æ‰€è§£èª¬

### **Versionç­‰(ä»Šå›è¿½åŠ ã—ãŸç®‡æ‰€ã‚’ä¸­å¿ƒã«è¦æ‰€ã®ã¿æŠœç²‹)**

(nodeã«é–¢ã—ã¦ã¯20ç³»ã®æœ€æ–°ç‰ˆã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™)

```json:package.json
{
  <ä¸­ç•¥>
  "devDependencies": {
    "@nuxt/devtools": "^1.0.3",
    "@vitest/coverage-v8": "^0.34.6",
    "@vitest/ui": "^0.34.6",
    "@vue/test-utils": "^2.4.1",
    "jsdom": "^22.1.0",
    "nuxt": "3.8.2",
    "typescript": "^5.2.2",
    "unplugin-auto-import": "^0.16.6",
    "unplugin-vue-components": "^0.25.2",
    "vite-plugin-vuetify": "^1.0.2",
    "vitest": "^0.34.6",
    "vuetify": "3.4.2"
  }
  <ä¸­ç•¥>
}
```

### Dockerå¯¾å¿œ

å€‹äººçš„ã«ã¯dockerã§ç«‹ã¡ä¸Šã’ã‚‹ã®ã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã ã‘ã§ã„ã„ã ã‚ã†ã¨è€ƒãˆã¦ã„ã¾ã—ãŸãŒã€ã„ã–ã€dockerã‚’æ§‹ç¯‰ã—ã¦ã¿ã‚‹ã¨(ãŸã¨ãˆæœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤ã«ã¯ä½¿ã‚ãªã„ã¨ã—ã¦ã‚‚)ã‚„ã£ã±ã‚Šç«‹ã¡ä¸Šã’ãŒæ¥½ã§ã™ã­ã€‚

ã¾ãšã¯Dockerfileã‹ã‚‰

```Dockerfile:Dockerfile
FROM node:20-alpine3.17

ENV TZ Asia/Tokyo

WORKDIR /frontend

COPY package.json ./
```

ç¶šã„ã¦compose.yml

```yml:compose.yml
version: '3.9'

x-common-settings: &common-settings
  build: .
  volumes:
    - .:/frontend:cached
    - nuxt-node-modules:/frontend/node_modules:delegated
  tty: true

services:
  dev_nuxt:
    container_name: dev_nuxt
    <<: *common-settings
    ports:
      - '3000:3000'
    command: >
      sh -c `
      npm install &&
      npm run dev
      `
  prod_nuxt:
    container_name: prod_nuxt
    <<: *common-settings
    ports:
      - '3001:3001'
    command: >
      sh -c `
      npm install &&
      npm run build &&
      PORT=3001 node ./.output/server/index.mjs
      `
  storybook:
    container_name: storybook
    <<: *common-settings
    ports:
      - '6006:6006'
    command: >
      sh -c `
      npm install &&
      npm run storybook
      `
  vitest:
    container_name: vitest
    <<: *common-settings
    command: npm run test --exit

volumes:
  nuxt-node-modules:

```

ä¸‹è¨˜è¨­å®šã®ç®‡æ‰€ã§å…±é€šã—ã¦ã„ã‚‹è¨­å®šã‚’ã¾ã¨ã‚ã¦ã„ã¾ã™ã€‚å„containerã§ã¯`<<: *common-settings`ã¨æ›¸ã„ã¦å‘¼ã³å‡ºã—ã¾ã™ã€‚

```yml:compose.yml
x-common-settings: &common-settings
  build: .
  volumes:
    - .:/frontend:cached
    - nuxt-node-modules:/frontend/node_modules:delegated
  tty: true
```

ã¾ãšã€å…ˆè¿°ã®Dockerfileã§ã¯`RUN npm install`ã‚’è¡Œã‚ãšã€compose.ymlã§ã‚„ã£ã¦ã„ã‚‹ç†ç”±ã§ã™ãŒã€Dockerfileã§ã¯`RUN npm install`ã‚’è¡Œã†å ´åˆã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ›´æ–°ãŒã‚ã£ãŸéš›ã«ä¸‹è¨˜ã®ã‚ˆã†ãªã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¤å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆã‚ãã¾ã§ä¸€ä¾‹ã«ãªã‚Šã¾ã™ã€‚å®Ÿéš›ã«ã¯ã‚„ã‚Šæ–¹ã¯ä½•é€šã‚Šã‹ã‚ã‚Šã¾ã™ï¼‰

```bash
docker compose run --rm dev_nuxt npm install
docker compose run --rm prod_nuxt npm install
```

å€‹äººé–‹ç™ºãªã‚‰å•é¡Œãªã„ã®ã§ã™ãŒã€ï¼ˆä¼šç¤¾ç­‰ã§ï¼‰è¤‡æ•°äººã§é–‹ç™ºã—ã¦ã„ã‚‹å ´åˆã€PRã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹éš›ã«ä¸Šè¨˜ã‚³ãƒãƒ³ãƒ‰ã®æ‰“ã¡å¿˜ã‚ŒãŒç™ºç”Ÿã—å¾—ã‚‹ã®ã§ã™ã€‚ãã®åº¦ã«
**ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼**ã€Œã“ã®PRå‹•ã‹ãªã„ã‚ˆã€
**ç­†è€…**ã€Œã‚ã€ä»Šå›ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ›´æ–°ãŒã‚ã£ãŸã®ã§æ›´æ–°ã‚³ãƒãƒ³ãƒ‰æ‰“ã£ã¦ãã ã•ã„ï¼ã€
**ãƒ¬ãƒ“ãƒ¥ãƒ¯ãƒ¼**ã€Œäº†è§£ã€œã€
ã¿ãŸã„ãªå•ç­”ã‚’ã™ã‚‹ã®ã‚‚æ‰‹é–“ã§ã™ã€‚

ãã®ãŸã‚ã€`npm install`ã¯compose.ymlã®commandã«è¨­å®šã—ã¦ã„ã¾ã™ã€‚
ä¸‹è¨˜è¨˜äº‹ã‚’å‚è€ƒã«ã•ã›ã¦ã„ãŸã ãã¾ã—ãŸã€‚

https://qiita.com/shindex/items/1deb070222d55a7d645d

### Vitestå¯¾å¿œ

viteãƒ™ãƒ¼ã‚¹ã®vueç’°å¢ƒã ã¨vite.config.tsã®ä¸­ã«æ›¸ã„ãŸã‚Šã‚‚ã—ã¾ã™ãŒã€nuxtã§ã¯nuxt.config.tsãŒã‚ã‚‹ã®ã§testã«é–¢ã™ã‚‹è¨­å®šã®ã¿ã‚’æ›¸ãvitest.config.tsã‚’ä½œæˆã—ã¾ã™ã€‚

happy-domã‚’ä½¿ã†ã®ã‚‚è‰¯ã‹ã£ãŸã‚“ã§ã™ãŒã€å®‰å®šæ€§é‡è¦–ã§jsdomæ¡ç”¨ã¨ã—ã¾ã—ãŸã€‚
ã‚¨ã‚¤ãƒªã‚¢ã‚¹ã¯å¿…è¦ã«å¿œã˜ã¦è¿½åŠ ã—ã¦ãã ã•ã„ã€‚

ã‚ã¨ã¯testé…ä¸‹ã«.test.tsã‹.spec.tsã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã ã‘ã§ã™ã€‚

```ts:vitest.config.ts
// <reference types="vitest">
import { defineConfig } from 'vitest/config'
import Vue from '@vitejs/plugin-vue'
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import { Vuetify3Resolver } from 'unplugin-vue-components/resolvers'
import { fileURLToPath } from 'node:url'

export default defineConfig({
  plugins: [
    Vue(),
    AutoImport({
      dirs: ['utils', 'composables'],
      imports: ['vue', 'vue-router', 'vitest'],
      dts: 'test/auto-imports.d.ts'
    }),
    Components({
      dirs: ['components'],
      resolvers: [Vuetify3Resolver()],
      directoryAsNamespace: true,
      dts: 'test/components.d.ts'
    })
  ],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./', import.meta.url)),
      '~': fileURLToPath(new URL('./', import.meta.url)),
    }
  },
  test: {
    root: '.',
    globals: true,
    environment: 'jsdom',
    coverage: {
      provider: 'v8',
      enabled: true
    }
  }
})
```

### Storybookå¯¾å¿œ

ä»Šå›ã®æ›´æ–°ä½œæ¥­ã®ä¸­ã§ä¸€ç•ªæ™‚é–“ãŒæ›ã‹ã‚Šã¾ã—ãŸã€‚ã€‚ã€‚
ãªãœæ™‚é–“ãŒæ›ã‹ã£ãŸã®ã‹ã®è©³ç´°ã¯åˆ¥è¨˜äº‹ã‚’æ›¸ãã¤ã‚‚ã‚Šãªã®ã§ãã¡ã‚‰ã«è­²ã‚‹ã¨ã—ã¦ã€ã“ã“ã§ã¯æ¦‚è¦ã®ã¿ã¾ã¨ã‚ã¾ã™ã€‚

Storybookã«ã¯åŸºæœ¬çš„ã«å…¬å¼ã‹ã‚‰æä¾›ã•ã‚Œã¦ã„ã‚‹å„ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ç”¨ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚ã‚Šã¾ã™ã€‚
![](/images/a8cc4f31c0ac45/storybook-why-page.png)
ã—ã‹ã—ã€Nuxt3ã¯å”¯ä¸€ä¸»è¦webãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã®ä¸­ã§Storybookå…¬å¼ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

ãã®ãŸã‚ã€è‡ªåŠ›ã§ç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

https://github.com/storybookjs/storybook-nuxt

â†‘ã“ã¡ã‚‰ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã—ãŸã€‚

READMEã‚’æ‹è¦‹ã™ã‚‹ã¨Stackblizä¸Šã§å‹•ãDemoã‚‚è¤‡æ•°ç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚ï¼ˆã‚ã‚ŠãŒãŸã„ï¼‰

ãã—ã¦å…¥ã‚Œã¦ã¿ã¦ãªã‚“ã‚„ã‹ã‚“ã‚„ã—ãŸçµæœã€

1. Nuxtã®versionã¯æœ€æ–°ã ã‘ã©Storybookã¯å…¥ã£ã¦ã„ãªã„ã€ŒNuxt3-templateã€repository
2. Nuxtã®versionã¯3.6.5æ­¢ã¾ã‚Šã‹ã¤ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã¯pnpmé™å®šã ã‘ã©Storybookã¯å‹•ãã€ŒNuxt3-template-with-storybookã€repository

ã®äºŒã¤ã«åˆ†ã‘ã¦ç®¡ç†ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã—ãŸã€‚

ä»¥é™ã€ŒNuxt3-template-with-storybookã€ã«ãŠã„ã¦ã®è©±ã¨ãªã‚Šã¾ã™ã€‚

ã¾ãšã¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã§ã™ã€‚
å…ƒã€…vitestã®è¨­å®šã¨åŒã˜ã‚ˆã†ã«`unplugin-auto-import`ã‚„`unplugin-vue-components`ã‚’ä½¿ã£ã¦ã“ã­ãã‚Šå›ã—ã¦ã„ã¾ã—ãŸãŒ`@storybook-vue/nuxt`ã‚’å°å…¥ã—ã¦ã‹ã‚‰ã¯å¿…è¦ãªããªã‚Šã¾ã—ãŸã€‚

```typescript:main.ts
import type { StorybookConfig } from '@storybook-vue/nuxt'
const config: StorybookConfig = {
  stories: [
    '../stories/**/*.mdx',
    '../stories/**/*.stories.@(js|jsx|ts|tsx)',
    '../components/**/*.mdx',
    '../components/**/*.stories.@(js|jsx|ts|tsx)',
  ],
  addons: [
    '@storybook/addon-links',
    '@storybook/addon-essentials',
    '@storybook/addon-interactions'
  ],
  framework: {
    name: '@storybook-vue/nuxt',
    options: {}
  },
  docs: { autodocs: 'tag' }
}
export default config
```

```typescript:preview.ts
import { type Preview } from '@storybook/vue3'

const preview: Preview = {
  parameters: {
    actions: { argTypesRegex: '^on[A-Z].*' },
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/
      }
    }
  }
}

export default preview
```

ä»¥ä¸Šã¨ãªã‚Šã¾ã™ã€‚
ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã—ãŸäºŒã¤ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã¯ç¶™ç¶šçš„ã«ã‚­ãƒ£ãƒƒãƒã‚¢ãƒƒãƒ—ã—ã¦æ›´æ–°ã—ã¦ã„ãã¾ã™ã®ã§ã¾ãŸå¤§ããªå¤‰åŒ–ãŒã‚ã£ãŸã‚‰è¨˜äº‹ã«ã¾ã¨ã‚ãŸã„ã¨æ€ã„ã¾ã™ã€‚
